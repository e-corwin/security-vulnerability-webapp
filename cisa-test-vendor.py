import requests
import json
from datetime import date, datetime, timedelta

cisa_api = requests.get('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json')
cisa_data = json.loads(cisa_api.content)

with open(f"cisa_data.json", "w") as outfile:
    json.dump(cisa_data, outfile, indent = 2)

title = cisa_data['title']
print(title)


# Finding Today's Date
todays_date = datetime.today()
todays_date_string = todays_date.strftime("%Y-%m-%d")
print("Today's Date:" , todays_date_string)
str(todays_date)
 
number = len(cisa_data['vulnerabilities'])
print(number)

vendor_list= []
i = 0
while i < number:
    vendor = cisa_data['vulnerabilities'][i]['vendorProject']
    if vendor not in vendor_list:
        vendor_list.append(vendor)
    i = i + 1

print(vendor_list)
print(len(vendor_list))

i = 0

vendor_dict = {}
for vendor in vendor_list:
    vendor_dict[vendor] = []

print(vendor_dict)


while i < number:
    cve_id_vendor = cisa_data['vulnerabilities'][i]['vendorProject']
    if vendor_dict[cve_id_vendor] == []:
        vendor_dict[cve_id_vendor].append(cisa_data['vulnerabilities'][i])
    else:
        vendor_dict[cve_id_vendor].append(cisa_data['vulnerabilities'][i])

    i = i + 1


with open(f"vendor_dict.json", "w") as outfile:
    json.dump(vendor_dict, outfile, indent = 2)

print(len(vendor_dict))
