import requests
import json
from datetime import date, datetime, timedelta

cisa_api = requests.get('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json')
cisa_data = json.loads(cisa_api.content)

with open(f"cisa_data.json", "w") as outfile:
    json.dump(cisa_data, outfile, indent = 2)

title = cisa_data['title']
print(title)


# Finding Today's Date
todays_date = datetime.today()
todays_date_string = todays_date.strftime("%Y-%m-%d")
print("Today's Date:" , todays_date_string)
str(todays_date)
 
week_before_date = todays_date - timedelta(weeks = 1) 
print("Week before date: ", week_before_date)

number = len(cisa_data['vulnerabilities'])
print(number)

add_in_week_dict = {"vulnerabilities": []}
print(add_in_week_dict)
print("---")

mod_in_week_dict = {"vulnerabilities": []}
print(add_in_week_dict)
print("---")

motifWidth = 1
weightMatrix = []
for k in range(motifWidth):
    weightMatrix.append({'A':0,'C':0,'G':0,'T':0})

print(weightMatrix)
weightMatrix = json.loads(weightMatrix)

with open(f"weightMatrix.json", "w") as outfile:
    json.dump(weightMatrix, outfile, indent = 2)


# Added in the last week

# Add date has to be less than today and greater than 1 week from today
i = 1

# Converts the due date string into a date type with format YYYY-MM-DD
add_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dateAdded'], "%Y-%m-%d")
add_in_week_dict['vulnerabilities'] = cisa_data['vulnerabilities'][i]


# Add date has to be less than today and greater than 1 week from today
while i < number:
    if add_date_datetype <= todays_date and add_date_datetype >= week_before_date:
        print(cisa_data['vulnerabilities'][i]['vulnerabilityName'], "is due in the next week")
        print(add_date_datetype)
        print("-------")
        #j = len(due_in_week_dict['vulnerabilities']) + 1
        #print("length of dict" , j)
        #due_in_week_dict['vulnerabilities'] = cisa_data['vulnerabilities'][j]
        #print(due_in_week_dict)
    add_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dateAdded'], "%Y-%m-%d")
    i = i + 1
    # print(due_in_week_dict)
    # print("------")

'''
# Modified in the last week

i = 1
# Converts the due date string into a date type with format YYYY-MM-DD
due_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dueDate'], "%Y-%m-%d")
while i < number:
    if due_date_datetype < todays_date:
        print("----")
        print(cisa_data['vulnerabilities'][i]['dueDate'])
        print(cisa_data['vulnerabilities'][i]['vulnerabilityName'], "is overdue")
    
    due_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dueDate'], "%Y-%m-%d")
    i = i + 1
    
'''
