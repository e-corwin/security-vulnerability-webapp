import requests
import json
from datetime import date, datetime, timedelta

cisa_api = requests.get('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json')
cisa_data = json.loads(cisa_api.content)

with open(f"cisa_data.json", "w") as outfile:
    json.dump(cisa_data, outfile, indent = 2)

title = cisa_data['title']
print(title)


# Finding Today's Date
todays_date = datetime.today()
todays_date_string = todays_date.strftime("%Y-%m-%d")
print("Today's Date:" , todays_date_string)
str(todays_date)
 
week_before_date = todays_date - timedelta(weeks = 1) 
print("Week before date: ", week_before_date)

number = len(cisa_data['vulnerabilities'])
print(number)
'''
add_in_week_dict = {"vulnerabilities": []}
print(add_in_week_dict)
print("---")

mod_in_week_dict = {"vulnerabilities": []}
print(add_in_week_dict)
print("---")
'''
add_in_week_dict = {}
recentlyAdded = []
add_in_week_dict['recentlyAdded'] = []

# ADDED IN THE LAST WEEK

# Add date has to be less than today and greater than 1 week from today
i = 1

# Converts the due date string into a date type with format YYYY-MM-DD
add_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dateAdded'], "%Y-%m-%d")

# Add date has to be less than today and greater than 1 week from today
i = 0

while i < number:
    if add_date_datetype <= todays_date and add_date_datetype >= week_before_date:
        #vendor = cisa_data['vulnerabilities'][i]['dateAdded']
        
        add_in_week_dict['recentlyAdded'].append(cisa_data['vulnerabilities'][i])
    add_date_datetype = datetime.strptime(cisa_data['vulnerabilities'][i]['dateAdded'], "%Y-%m-%d")
    i = i + 1

with open(f"recently_added_dict.json", "w") as outfile:
    json.dump(add_in_week_dict, outfile, indent = 2)


# MODIFIED IN THE LAST WEEK
