import requests
import json
from datetime import date
# Get a JSON of a specific service ID
# cve_API = requests.get('https://services.nvd.nist.gov/rest/json/cves/2.0?cpeName=cpe:2.3:o:microsoft:windows_10:1607')

# Full list of CVEs
# cve_api = requests.get('https://cve.circl.lu/api/last')
# cve_data = json.loads(cve_api.content)
# print(cve_API.status_code) # returns 200 means that it is working!
# print(cve_api.text)

# with open(f"cve_data.json", "w") as outfile:
    # json.dump(cve_data, outfile, indent = 2)


cisa_api = requests.get('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json')
cisa_data = json.loads(cisa_api.content)


#print(json.dumps(data, indent = 2))
with open(f"cisa_data.json", "w") as outfile:
    json.dump(cisa_data, outfile, indent = 2)

title = cisa_data['title']
print(title)
vulnerability = cisa_data['vulnerabilities'][0]
due_date = cisa_data['vulnerabilities'][0]['dueDate']
date_added = cisa_data['vulnerabilities'][0]['dateAdded']
#print(vulnerability)
print(due_date)
# print(date_added)

# Finding Today's Date
todays_date = date.today()
print("Today's Date: " , todays_date)
str(todays_date)

number = len(cisa_data['vulnerabilities'])

print(number)

# Debugging
#print(cisa_data['vulnerabilities'][997]['dueDate'])

print(todays_date == '2023-09-14')

'''
i = 1
while i < number:
    #print(i)
    due_date = cisa_data['vulnerabilities'][i]['dueDate']
    print(due_date)

    if due_date == todays_date:
        print("DUE TODAY")
        print(due_date)
        print(i)

    else:
        print("NOTHING DUE TODAY")

    i = i + 1
'''





#print(cisa_api.text)

# cve_api = requests.get('https://cve.circl.lu/api/cve/CVE-2010-3333')
# print(cve_api.text)



# cve_ids
# cve_summaries
# each document should be a CVE


